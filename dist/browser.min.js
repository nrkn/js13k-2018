let s=()=>{let t=t=>new Promise(e=>{let n=new Image;n.onload=(()=>e(n)),n.src=t}),e=t=>t[n(t.length)],n=(t,e=0)=>~~(Math.random()*t)+e,o=(t,e)=>Math.max(t,e)-Math.min(t,e),r=([t,e])=>[[t-1,e],[t+1,e],[t,e-1],[t,e+1]],s=(t,e,n)=>r(e).filter(e=>t[e[1]][e[0]]===n),l=(t,[n,r],s,c)=>{let l=t.filter(([t,e])=>o(t,n)>=s&&o(e,r)>=s&&o(t,n)<=c&&o(e,r)<=c);return e(l)},h=([t,e],n)=>{let o=[],s=[[t,e,0]],c=[],l=([t,e,l])=>{d([t,e])&&n([t,e])&&(c[128*e+t]||(o.push([t,e,l]),c[128*e+t]=!0,s.push(...r([t,e]).map(([t,e])=>[t,e,l+1]))))};for(;s.length;)l(s.shift());return o},f=(t,[e,n])=>{let o=[],[s,c]=t[0],l=((t,[e,n])=>{for(let o=0;o<t.length;o++)if(t[o][0]===e&&t[o][1]===n)return t[o]})(t,[e,n]);if(!l)return o;let h=[l],f=([e,n,l])=>{if(o.unshift([e,n]),e===s&&n===c)return;let f;r([e,n]).forEach(([e,n])=>{let o=t.find(([t,o])=>t===e&&o===n);if(o){let[,,t]=o;t<l&&(l=t,f=o)}}),f&&h.push(f)};for(;h.length;)f(h.shift());return o},g=([t,n],[s,c],l=d,h=.66)=>{let f=[],g=([t,n])=>{u(f,[t,n])||f.push([t,n]),t===s&&n===c||g(Math.random()<h?e(r([t,n]).filter(l))||[t,n]:(([t,e],[n,r])=>{let s=o(t,n),c=o(e,r),l=t,h=e;return s>c&&(n>t&&(l=t+1),t>n&&(l=t-1)),c>s&&(r>e&&(h=e+1),e>r&&(h=e-1)),[l,h]})([t,n],[s,c]))};return g([t,n]),f},i=t=>[3===t?21:1===t?107:n(86,21),0===t?21:2===t?107:n(86,21)],a=()=>[n(86,21),n(86,21)],u=(t,[e,n])=>{for(let o=0;o<t.length;o++)if(t[o][0]===e&&t[o][1]===n)return!0;return!1},d=([t,e])=>t>=0&&t<=127&&e>=0&&e<=127,S=([t,e])=>t>=8&&t<=120&&e>=8&&e<=120,E=(t,e,n)=>{for(let o=0;o<e.length;o++){let[r,s]=e[o];t[s][r]=n([r,s])}},m=()=>{let t=(()=>{let t=[];for(let e=0;e<128;e++){let e=[];for(let t=0;t<128;t++)e.push(1);t.push(e)}return t})(),o=n(15,10),r=[i(0),i(1),i(2),i(3)];for(let t=4;t<o;t++)r.push(a());for(let e=1;e<o;e++){let n=g(r[e-1],r[e],S);E(t,n,()=>2)}let c=((t,e)=>{let n=[];for(let o=0;o<128;o++)for(let r=0;r<128;r++)t[o][r]===e&&n.push([r,o]);return n})(t,2),d=c.slice();((t,n,o=4096)=>{for(;n.length<o;){let[o,r]=e(n),c=s(t,[o,r],1).filter(S);if(c.length){let[o,r]=e(c);u(n,[o,r])||(n.push([o,r]),t[r][o]=2)}}})(t,c);let m=h([0,0],([e,n])=>1===t[n][e]);E(t,m,()=>0),((t,e)=>{for(let o=0;o<128;o++)for(let r=0;r<128;r++)2===t[o][r]&&(s(t,[r,o],0).length?t[o][r]=n(3)+14:u(e,[r,o])?t[o][r]=n(6)+2:t[o][r]=n(7)+2),1===t[o][r]&&(t[o][r]=n(2)+7)})(t,d);let[p,I]=(t=>{let e=128,n=[0,0];for(let o=0;o<t.length;o++){let[r,s]=t[o];r<e&&(e=r,n=[r,s])}return n})(c);let C;for(;!C;)C=l(d,[p,I],n(5)+10,n(5)+20);let[N,O]=C,[k,R]=l(d,[N,O],n(5)+10,n(5)+20),T=[[p,I],[N,O],[k,R]];for(;T.length<15;){let[o,r]=e(T),s=12*n(10),c=12*n(10),g=l(d,[s,c],1,12),i=h([o,r],([e,n])=>0!==t[n][e]);if(g&&i.length){let e=f(i,g);T.push(g),E(t,e,([e,n])=>t[n][e]>=14&&t[n][e]<17?t[n][e]:2)}}for(let e=2;e<15;e++){let[n,o]=T[e];t[o][n]=17}return[3,p,I,t]},p=[[0,"s.png"],[1,["Lost contact with","RANGER. Take boat","and investigate."]],[1,["Sunrise"]],[1,["Sunset"]],[2,["RSOS v3.27","","ERROR:"," SYSTEM OFFLINE","","EMERGENCY OPS:",""],[["DIAGNOSTICS",5],["SYNTHESIZE",6]]],[2,["DIAGNOSTICS","","MAIN SYSTEM:"," OFFLINE",""," PROBLEM:","  6 CAPS BLOWN","","SYNTHESIZE:"," ONLINE"],[]],[2,["SYNTHESIZE","","SYNTHDB:"," OFFLINE","","EMERGENCY OPS:",""],[["BASIC RATIONS",4]]],m()],I=t=>{let e=Y[0]()[6],n=Y[0]()[7];c.className=e,c.width=c.height=160,3===n[0]&&(k(t),R()),0===n[0]&&"s.png"===n[1]&&T.drawImage(M,0,0),1===n[0]&&O(n[1]),requestAnimationFrame(I)},C=(t="",e=0,n=0)=>T.drawImage(y,8*(t.charCodeAt(0)-32),0,8,8,8*e,8*n,8,8),N=(t="",e=0,n=0)=>{for(let o=0;o<t.length;o++)C(t[o],e+o,n)},O=t=>{let e=~~((20-t.length)/2);for(let n=0;n<t.length;n++){let o=~~((20-t[n].length)/2);N(t[n],o,e+n)}},k=t=>{let e=~~(t/500)%2?0:1,n=Y[0]()[7],o=n[3],r=n[1],s=n[2],c=Y[0]()[2],l=Y[0]()[0];for(let t=0;t<9;t++)for(let n=0;n<9;n++){let h=r-4+n,f=s-4+t;let g=16*e;if(d([h,f])){let t=o[f][h];t&&(g=16*t)}T.drawImage(w,g,0,16,16,16*(n+1),16*(t+1),16,16),4===n&&4===t&&(g=c?16*e+16*l*2:64,T.drawImage(A,g,0,16,16,16*(n+1),16*(t+1),16,16))}},R=()=>{let t=Y[0]()[1],e=Y[0]()[2];N(`RANGER DOWN   ${Y[2]()}`,.5,.5),T.drawImage(w,160,0,16,16,0,16,16,16),N(`${e}`,e<10?.5:0,4),T.drawImage(w,144,0,16,16,0,48,16,16),N(`${t}`,t<10?.5:0,8)},T=c.getContext("2d");let y,w,A,M,Y=(()=>{let t,e,n,o,r,s,c,l;let h=()=>{t=0,e=5,n=2,o=10,r=6,s=5,p[7]=m(),l=[p[7],p[1],p[0]],c=""},f=()=>{60==++s&&(s=0,6==++r&&(c="",l.push(p[2])),18===r&&(c="i",l.push(p[3])),e>0?(e--,n<o&&n++):n--),24===r&&(r=0)};return h(),[()=>[t,e,n,o,r,s,(()=>0===l[l.length-1][0]?"g":1===l[l.length-1][0]?"g":2===l[l.length-1][0]?"a":c)(),l[l.length-1]],h,()=>`${r<10?"0":""}${r}:${s<10?"0":""}${s}`,f,(e,o)=>{let r=l[l.length-1];3===r[0]&&(f(),-1===e&&(t=1),1===e&&(t=0),e=r[1]+e,o=r[2]+o,n>0&&d([e,o])&&!(t=>t<2||8===t)(r[3][o][e])&&(r[1]=e,r[2]=o))},()=>{l.pop(),l.length||(l=[p[7]])}]})();document.onkeyup=(t=>{let e=Y[0]()[7];3===e[0]&&(t=>{65!==t.keyCode&&37!==t.keyCode||Y[4](-1,0),68!==t.keyCode&&39!==t.keyCode||Y[4](1,0),87!==t.keyCode&&38!==t.keyCode||Y[4](0,-1),83!==t.keyCode&&40!==t.keyCode||Y[4](0,1)})(t),0!==e[0]&&1!==e[0]||32!==t.keyCode&&27!==t.keyCode&&13!==t.keyCode||Y[5](),e[0]}),c.ontouchend=(t=>{let e=Y[0]()[7];if(3!==e[0])0!==e[0]&&1!==e[0]||Y[5](),e[0];else for(let e=0;e<t.changedTouches.length;e++){let n=c.getBoundingClientRect().width/10,r=~~(t.changedTouches[e].clientX/n)-1,s=~~(t.changedTouches[e].clientY/n)-1;if(4===r&&4===s)return;if(r<0||s<0)return;let l=o(r,4),h=o(s,4);let f=0,g=0;l>h?f=r>4?1:-1:l<h&&(g=s>4?1:-1),Y[4](f,g)}}),((...e)=>Promise.all(e.map(t)))("f.gif","t.gif","p.gif","s.png").then(t=>{[y,w,A,M]=t,requestAnimationFrame(I)})};s();